
# 🔵 핵심 워크플로우 (모든 작업에 적용)

> **전략 등록 → 백테스트 → 시뮬레이션 → 실전 운용**

이 워크플로우는 프로젝트 전체에 적용되는 표준 프로세스입니다.

## 테스트/검증 워크플로우

전략 개발 및 검증 시 실제로 진행되는 프로세스입니다.

```
┌─────────────────────────────────────────────────────────────┐
│  1. 전략 등록                                                │
│     - Strategies.tsx에서 전략 생성/저장                       │
└─────────────────────────┬───────────────────────────────────┘
                          ▼
┌─────────────────────────────────────────────────────────────┐
│  2. 백테스트 시도                                            │
│     - Backtest.tsx에서 등록된 전략 선택                       │
│     - 심볼/기간 설정 후 실행                                  │
└─────────────────────────┬───────────────────────────────────┘
                          ▼
┌─────────────────────────────────────────────────────────────┐
│  3. 데이터셋 자동 요청                                        │
│     - 해당 심볼/기간의 OHLCV 데이터 필요                       │
│     - 캐시 없으면 Yahoo Finance에서 자동 다운로드              │
└─────────────────────────┬───────────────────────────────────┘
                          ▼
┌─────────────────────────────────────────────────────────────┐
│  4. 백데이터 확보 → 백테스트 수행                             │
└─────────────────────────┬───────────────────────────────────┘
                          ▼
              ┌───────────────────────┐
              │    오류 발생?         │
              └───────────┬───────────┘
                    Yes   │   No
         ┌────────────────┴────────────────┐
         ▼                                 ▼
┌─────────────────────┐        ┌─────────────────────────────┐
│  5. 데이터셋 확인    │        │  6. 백테스트 성공            │
│  - Dataset.tsx      │        │  - 결과 분석 및 저장         │
│  - 데이터 품질 검증  │        └──────────────┬──────────────┘
│  - 누락 구간 확인    │                       │
└──────────┬──────────┘                       │
           ▼                                  │
┌─────────────────────┐                       │
│  오류 수정           │                       │
│  - 데이터 재다운로드 │                       │
│  - 코드 버그 수정    │                       │
└──────────┬──────────┘                       │
           │                                  │
           └──────────► 2번으로 복귀 ◄─────────┘
                                              │
                          (모든 전략 백테스트 완료)
                                              ▼
┌─────────────────────────────────────────────────────────────┐
│  7. 시뮬레이션 테스트                                        │
│     - 모든 전략에 대해 시뮬레이션 실행                        │
│     - 실시간 데이터 피드 검증                                 │
└─────────────────────────┬───────────────────────────────────┘
                          ▼
┌─────────────────────────────────────────────────────────────┐
│  8. 실전 운용 준비 완료                                      │
└─────────────────────────────────────────────────────────────┘
```

**핵심 포인트:**
- 오류의 정의는 전략의 등록이 실패했거나, 특정 조건이 만족되지 않아 백 테스팅시 시그널이 하나도 발생하지 않았거나, 아에 백 테스팅이 실패했거나, 시뮬레이션이 제대로 동작하지 않거나 등입니다.
- 만약 발생한 오류가 명백한 코드의 잘못이라면 반드시 오류를 수정하고 처음부터 다시 진행해야 합니다.
- 전략의 복제나 삭제의 경우 문제가 발생한게 아니라면 한번만 테스트하면 됩니다.
- 오류가 발생하면 **Dataset화면에서 데이터의 품질을 확인** 하고, 데이터가 정상이라면 전략의 파라미터를 **백테스팅 시 시그널이 발생 할 수 있도록** 수정해야 합니다.
- 백 테스트의 성공 조건은 백테스트 결과가 발생했을 때 시그널이 존재해야 하고, 백 테스트 결과를 펼쳐서 실제 차트 정보가 유효한 범위안에 있어야 하며, 거래 내역도 유효한 범위내에 있어야 합니다. 상세 지표 보기를 눌러 상세 지표의 유효성도 체크하여 모두 유효한 결과가 나와야 합니다.
- 백테스트가 완료되면 항상 해당 백테스트 결과를 삭제해야 합니다. 이는 데이터를 클린하게 유지하기 위함입니다.
- 시뮬레이션의 경우 특성상 결과가 오래 걸릴 수 있기 때문에 반드시 배속 기능도 테스트가 진행이 되어야 합니다.
- 시뮬레이션의 완료 조건은 시뮬레이션이 진행되면서 에러가 발생하지 않아야 합니다. 네트워크 에러가 발생한다거나 해서 더 이상 업데이트가 안되면 실패입니다.
- 시뮬레이션 진행시 거래 내역과 차트가 유효해야 합니다.

- 전략 하나를 완전히 검증하려면 **데이터셋까지 연결**되어야 함
- **모든 전략**에 대해 백테스트 → 시뮬레이션 순서로 완료해야 함

## 🔄 회귀 테스트 (Regression Test) 구조

이 워크플로우는 **회귀 테스트 패턴**을 따릅니다.

### 회귀 테스트 원칙
1. **한 번 통과한 테스트는 계속 통과해야 함**
   - 새로운 변경사항이 기존 기능을 깨뜨리면 안 됨
   - 코드 수정 후 반드시 전체 테스트 재실행

2. **전략별 테스트 기준선 (Baseline)**
   - 각 전략의 백테스트 결과를 기준선으로 저장
   - 코드 변경 후 동일한 입력에 대해 동일한 결과 보장

3. **테스트 순서**
   ```
   코드 변경 → 단위 테스트 → 모든 전략 백테스트 → 시뮬레이션 검증
                              ↓
                         결과 비교 (기준선 vs 현재)
                              ↓
                    차이 발생? → 의도된 변경인지 확인
   ```

4. **자동화 목표**
   - `cargo test` → 단위 테스트 (258개)
   - 백테스트 회귀 테스트 → 모든 전략 자동 실행 (향후)
   - 시뮬레이션 회귀 테스트 → 주요 전략 자동 실행 (향후)

```
┌─────────────────────────────────────────────────────────────┐
│  1. 전략 페이지 (Strategies.tsx)                             │
│     - 루트 전략 선택 + 파라미터 튜닝                          │
│     - 파생 전략으로 저장 (고유 이름)                          │
│     - 리스크 설정 포함                                       │
└─────────────────────────┬───────────────────────────────────┘
                          ▼
┌─────────────────────────────────────────────────────────────┐
│  2. 백테스트 페이지 (Backtest.tsx)                           │
│     - 등록된 전략 선택 (파라미터 입력 불필요)                  │
│     - 심볼/기간/초기자본만 입력                               │
│     - 결과 분석 및 저장                                      │
└─────────────────────────┬───────────────────────────────────┘
                          ▼
┌─────────────────────────────────────────────────────────────┐
│  3. 시뮬레이션 페이지 (Simulation.tsx)                       │
│     - 등록된 전략 선택                                       │
│     - 실시간 모의 거래 실행                                   │
│     - 성과 모니터링                                          │
└─────────────────────────┬───────────────────────────────────┘
                          ▼
┌─────────────────────────────────────────────────────────────┐
│  4. 실전 운용 (Dashboard)                                    │
│     - 검증된 전략 활성화                                      │
│     - 실제 거래 실행                                         │
│     - 포트폴리오 관리                                        │
└─────────────────────────────────────────────────────────────┘
```
